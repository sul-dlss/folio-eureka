global:
  security:
    allowInsecureImages: true
image:
  registry: folioorg
  repository: folio-kong
  tag: 3.9.1
  pullPolicy: Always
useDaemonset: false
replicaCount: 1
containerSecurityContext:
  enabled: true
  seLinuxOptions: {}
  runAsUser: 1001
  runAsGroup: 1001
  runAsNonRoot: true
  privileged: false
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop: ["ALL"]
  seccompProfile:
    type: "RuntimeDefault"
database: postgresql
postgresql:
  enabled: false
  external:
    existingSecret: "kong-credentials"
    existingSecretPasswordKey: "KONG_PG_PASSWORD"
networkPolicy:
  enabled: false
service:
  exposeAdmin: true
  disableHttpPort: false
  ports:
    proxyHttp: 8000
    proxyHttps: 443
    adminHttp: 8001
    adminHttps: 8444
kong:
  livenessProbe:
    enabled: false
  readinessProbe:
    enabled: false
  startupProbe:
    enabled: false
  extraEnvVars:
  - name: KONG_PASSWORD
    valueFrom:
      secretKeyRef:
        name: kong-credentials
        key: KONG_PASSWORD
  - name: KONG_PG_PASSWORD
    valueFrom:
      secretKeyRef:
        name: kong-credentials
        key: KONG_PG_PASSWORD
  - name: KONG_PG_PASSWORD_FILE
    value: null
  - name: KONG_UPSTREAM_TIMEOUT
    value: "1200000"
  - name: KONG_UPSTREAM_SEND_TIMEOUT
    value: "1200000"
  - name: KONG_UPSTREAM_READ_TIMEOUT
    value: "1200000"
  - name: KONG_NGINX_HTTP_CLIENT_MAX_BODY_SIZE
    value: "256M"
  - name: KONG_NGINX_PROXY_PROXY_NEXT_UPSTREAM
    value: "error timeout http_500 http_502 http_503 http_504"
  - name: "KONG_PROXY_SEND_TIMEOUT"
    value: "1200000"
  - name: "KONG_UPSTREAM_CONNECT_TIMEOUT"
    value: "1200000"
  - name: "KONG_PROXY_READ_TIMEOUT"
    value: "1200000"
  - name: "KONG_NGINX_HTTP_KEEPALIVE_TIMEOUT"
    value: "1200000"
  - name: "KONG_NGINX_UPSTREAM_KEEPALIVE"
    value: "1200000"
  - name: "KONG_UPSTREAM_KEEPALIVE_IDLE_TIMEOUT"
    value: "1200000"
  - name: "KONG_UPSTREAM_KEEPALIVE_POOL_SIZE"
    value: "1024"
  - name: "KONG_UPSTREAM_KEEPALIVE_MAX_REQUESTS"
    value: "20000"
  - name: "KONG_NGINX_HTTP_KEEPALIVE_REQUESTS"
    value: "20000"
  - name: KONG_PG_DATABASE
    valueFrom:
      secretKeyRef:
        name: kong-credentials
        key: KONG_PG_DATABASE
  - name: KONG_NGINX_PROXY_PROXY_BUFFERS
    value: "64 160k"
  - name: KONG_NGINX_PROXY_CLIENT_HEADER_BUFFER_SIZE
    value: "16k"
  - name: KONG_NGINX_HTTP_CLIENT_HEADER_BUFFER_SIZE
    value: "16k"
  - name: KONG_ADMIN_LISTEN
    value: "0.0.0.0:8001"
  - name: KONG_NGINX_PROXY_PROXY_BUFFER_SIZE
    value: "160k"
  - name: KONG_NGINX_PROXY_LARGE_CLIENT_HEADER_BUFFERS
    value: "4 16k"
  - name: KONG_PLUGINS
    value: "bundled"
  - name: KONG_MEM_CACHE_SIZE
    value: "2048m"
  - name: KONG_NGINX_HTTP_LARGE_CLIENT_HEADER_BUFFERS
    value: "4 16k"
  - name: KONG_ADMIN_GUI_API_URL
    value: "https://kong-folio-dev.stanford.edu"
  - name: KONG_NGINX_HTTPS_LARGE_CLIENT_HEADER_BUFFERS
    value: "4 16k"
  - name: KONG_PROXY_LISTEN
    value: "0.0.0.0:8000"
  - name: KONG_NGINX_WORKER_PROCESSES
    value: "auto"
  - name: EUREKA_RESOLVE_SIDECAR_IP
    value: "false"
  - name: KONG_LOG_LEVEL
    value: "info"
  resources:
    requests:
      ephemeral-storage: 50Mi
      memory: 12Gi
    limits:
      ephemeral-storage: 1Gi
      memory: 15Gi
ingressController:
  enabled: false
migration:
  command: ["/bin/sh", "-c"]
  args: ["echo 'Hello kong!'"]
extraDeploy:
  - |
    apiVersion: gateway.networking.k8s.io/v1
    kind: Gateway
    metadata:
      name: folio-gateway
      namespace: folio-dev
    spec:
      gatewayClassName: folio-gateway
      listeners:
      - hostname: folio-dev-gateway.stanford.edu
        name: folio-dev-gateway-stanford-edu-http
        port: 80
        protocol: HTTP
  - |
    apiVersion: gateway.networking.k8s.io/v1
    kind: HTTPRoute
    metadata:
      name: folio-backend
      namespace: folio-dev
    spec:
      hostnames:
      - folio-dev-gateway.stanford.edu
      parentRefs:
      - name: folio-gateway
      rules:
      - backendRefs:
        - name: kong
          port: 8443
        matches:
        - path:
            type: PathPrefix
            value: /
